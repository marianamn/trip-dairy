"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.usersController=void 0;var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_constants=require("constants"),_handlebars=require("handlebars"),_handlebars2=_interopRequireDefault(_handlebars),_utils=require("utils"),_templates=require("templates"),_toastr=require("toastr"),_toastr2=_interopRequireDefault(_toastr),_usersData=require("usersData"),usersController=function(){var e=function(){function e(t,a){_classCallCheck(this,e),this.data=t,this.templates=a}return _createClass(e,[{key:"register",value:function(){var e=this;this.templates.get("register").then(function(t){var a=_handlebars2.default.compile(t);(0,_jquery2.default)("#content").html(a()),(0,_jquery2.default)("#btn-register").on("click",function(t){t.preventDefault();var a={email:(0,_jquery2.default)("#tb-email").val(),firstName:(0,_jquery2.default)("#tb-firstName").val(),lastName:(0,_jquery2.default)("#tb-lastName").val(),profileImgURL:(0,_jquery2.default)("#tb-profileImgURL").val(),password:(0,_jquery2.default)("#tb-newPassword").val(),userInfo:(0,_jquery2.default)("#tb-userInfo").val(),facebookContact:(0,_jquery2.default)("#tb-facebookContact").val(),youTubeContact:(0,_jquery2.default)("#tb-youTubeContact").val(),twitterContact:(0,_jquery2.default)("#tb-twitterContact").val(),googlePlusContact:(0,_jquery2.default)("#tb-googlePlusContact").val(),instagramContact:(0,_jquery2.default)("#tb-instagramContact").val(),rssContact:(0,_jquery2.default)("#tb-rssContact").val()};return a.password.length<_constants.CONSTANTS.PASSWORD_MIN_LENGTH||a.password.length>_constants.CONSTANTS.PASSWORD_MAX_LENGTH||0===a.password.length?void _toastr2.default.error("Password must be between 3 and 20 symbols long!"):/\W+/.test(a.password)?void _toastr2.default.error("Password contains invalid symbols!"):(e.data.register(a).then(function(e){_toastr2.default.success("Successfully signed up. Please login!"),window.location="#/login"}).catch(function(e){console.log(e),_toastr2.default.error("Sign up was unsuccessfull, please try again!"),window.location="#/register"}),!1)})})}},{key:"login",value:function(){var e=this;this.templates.get("login").then(function(t){var a=_handlebars2.default.compile(t);(0,_jquery2.default)("#content").html(a()),(0,_jquery2.default)("#btn-login").on("click",function(t){t.preventDefault();var a={email:(0,_jquery2.default)("#tb-email").val(),password:(0,_jquery2.default)("#tb-password").val()};return e.data.login(a).then(function(e){(0,_jquery2.default)("#nav-btn-logout").removeClass("hidden"),(0,_jquery2.default)(".add-diary").removeClass("hidden"),(0,_jquery2.default)("#nav-btn-register").addClass("hidden"),(0,_jquery2.default)("#nav-btn-login").addClass("hidden"),localStorage.setItem("auth_key",e.body.token),localStorage.setItem("auth_email",e.body.email),_usersData.usersData.getAllUsers().then(function(t){var a=t.data,r=_utils.UTILS.HELPER_FUNCTIONS.getUserInfoByEmail(a,e.body.email);localStorage.setItem("profileImg",r.profileImgURL),localStorage.setItem("fullName",r.firstName+" "+r.lastName)}),_toastr2.default.success("Sign in successfully!"),window.location="#/home"},function(e){console.log(e),_toastr2.default.error("Invalid email or password!"),window.location="#/login"}),!1})})}},{key:"userById",value:function(e){var t=this,a=void 0,r=e.id;this.data.getUserById(r).then(function(e){return a=e.data,t.templates.get("diary-author-details")}).then(function(e){var t=_handlebars2.default.compile(e);(0,_jquery2.default)("#content").html(t(a))})}}]),e}(),t=new e(_usersData.usersData,_templates.templatesLoader);return{register:function(){return t.register()},login:function(){return t.login()},userById:function(e){return t.userById(e)}}}();exports.usersController=usersController;